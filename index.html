<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Chrome Dinosaur Game</title>
  <style>
    body {
      background: #f7f7f7;
      margin: 0;
      padding: 0;
      overflow: hidden;
      font-family: Arial, sans-serif;
    }
    #game-container {
      position: relative;
      width: 800px;
      height: 200px;
      margin: 40px auto;
      background: #fff;
      border: 2px solid #ccc;
      overflow: hidden;
    }
    #dino {
      position: absolute;
      bottom: 0;
      left: 50px;
      width: 44px;
      height: 47px;
      image-rendering: pixelated;
      transition: width 0.1s, height 0.1s;
      z-index: 10;
    }
    .cactus {
      position: absolute;
      bottom: 0;
      width: 25px;
      height: 50px;
      image-rendering: pixelated;
      z-index: 5;
    }
    #ground {
      position: absolute;
      left: 0;
      bottom: 0;
      width: 100%;
      height: 5px;
      background: #888;
    }
    #score {
      position: absolute;
      top: 10px;
      right: 20px;
      font-size: 20px;
      color: #555;
      font-family: monospace;
    }
    #game-over {
      display: none;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 20;
      width: 500px;
      max-width: 90%;
      pointer-events: none;
      background: none;
      border: none;
      padding: 0;
    }
  </style>
</head>
<body>
  <div id="game-container">
    <img id="dino" src="images/trex.png" alt="Dino">
    <div id="ground"></div>
    <div id="score">0</div>
    <img id="game-over" src="images/game over screen.png" alt="Game Over">
  </div>
  <script>
    // Image paths
    const dinoIdleImg = 'images/trex.png';
    const dinoRunImgs = [
      'images/trex run 1.png',
      'images/trex run 2.png'
    ];
    const dinoCrouchImgs = [
      'images/trex crouch 1.png',
      'images/trex crouch 2.png'
    ];
    const dinoGameOverImg = 'images/trex game over.png';
    const cactusImg = 'images/cactus.png';

    // Game variables
    const dino = document.getElementById('dino');
    const gameContainer = document.getElementById('game-container');
    const scoreElem = document.getElementById('score');
    const gameOverElem = document.getElementById('game-over');
    const ground = document.getElementById('ground');
    let dinoY = 0;
    let dinoVY = 0;
    let isJumping = false;
    let isCrouching = false;
    let gravity = -0.7;      // Negative gravity for upward jump
    let jumpPower = 12;      // Positive jump power
    let groundY = 0;
    let cactusSpeed = 7;
    let cactusInterval = 1200;
    let score = 0;
    let running = false;
    let dinoFrame = 0;
    let dinoAnimTimer = 0;
    let cacti = [];
    let gameLoopId = null;
    let cactusSpawnerTimeout = null;

    // Start screen: idle dino
    function showIdle() {
      dino.src = dinoIdleImg;
      dino.style.height = '47px';
      dino.style.width = '44px';
      dino.style.bottom = '0px';
      scoreElem.textContent = '0';
      gameOverElem.style.display = 'none';
    }

    // Handle jump and crouch
    document.addEventListener('keydown', (e) => {
      if (!running && (e.code === 'Space' || e.code === 'ArrowUp')) {
        startGame();
        return;
      }
      if ((e.code === 'Space' || e.code === 'ArrowUp') && !isJumping && running) {
        dinoVY = jumpPower;
        isJumping = true;
      }
      if ((e.code === 'ArrowDown' || e.code === 'KeyS') && running) {
        if (!isJumping && !isCrouching) {
          isCrouching = true;
          dino.style.height = '30px';
          dino.style.width = '59px';
          dino.style.bottom = '0px';
        }
        // If in the air, apply fast fall
        if (isJumping) {
          dinoVY -= 5; // Increase downward velocity (fall much faster)
        }
      }
      if (!running && e.code === 'Space' && gameOverElem.style.display === 'block') {
        restartGame();
      }
    });

    document.addEventListener('keyup', (e) => {
      if ((e.code === 'ArrowDown' || e.code === 'KeyS') && isCrouching) {
        isCrouching = false;
        dino.style.height = '47px';
        dino.style.width = '44px';
        dino.style.bottom = '0px';
      }
    });

    function spawnCactus() {
      // 1, 2, or 3 cacti side by side
      const groupSize = Math.floor(Math.random() * 3) + 1;
      const cactusGroup = [];
      // Place the group farther to the right if previous group exists
      let groupOffset = gameContainer.offsetWidth;
      if (cacti.length > 0) {
        // Find the rightmost cactus
        let maxRight = Math.max(...cacti.map(c => parseInt(c.style.left)));
        groupOffset = Math.max(groupOffset, maxRight + 120 + Math.random() * 60); // 120-180px gap
      }
      for (let i = 0; i < groupSize; i++) {
        const cactus = document.createElement('img');
        cactus.src = cactusImg;
        cactus.className = 'cactus';
        cactus.style.left = (groupOffset + i * 28) + 'px';
        cactus.style.width = '25px';
        cactus.style.height = '50px';
        gameContainer.appendChild(cactus);
        cactusGroup.push(cactus);
        cacti.push(cactus);
      }
    }

    function updateCacti() {
      for (let i = cacti.length - 1; i >= 0; i--) {
        let cactus = cacti[i];
        let left = parseInt(cactus.style.left);
        cactus.style.left = (left - cactusSpeed) + 'px';
        // Remove if out of screen
        if (left < -30) {
          cactus.remove();
          cacti.splice(i, 1);
        }
      }
    }

    function checkCollision() {
      const dinoRect = dino.getBoundingClientRect();
      for (let cactus of cacti) {
        const cactusRect = cactus.getBoundingClientRect();
        // Simple AABB collision
        if (
          dinoRect.right - 10 > cactusRect.left &&
          dinoRect.left + 10 < cactusRect.right &&
          dinoRect.bottom - 5 > cactusRect.top &&
          dinoRect.top + 5 < cactusRect.bottom
        ) {
          return true;
        }
      }
      return false;
    }

    function updateDinoAnim() {
      dinoAnimTimer++;
      if (dinoAnimTimer % 6 === 0) {
        dinoFrame = (dinoFrame + 1) % 2;
        if (isCrouching) {
          dino.src = dinoCrouchImgs[dinoFrame];
        } else if (!isJumping) {
          dino.src = dinoRunImgs[dinoFrame];
        } else {
          dino.src = dinoIdleImg;
        }
      }
    }

    function updateScore() {
      score++;
      scoreElem.textContent = score;
      if (score % 100 === 0 && cactusSpeed < 20) {
        cactusSpeed += 0.5;
      }
    }

    function gameLoop() {
      // Dino jump physics
      if (isJumping) {
        dinoY += dinoVY;
        dinoVY += gravity;
        if (dinoY < 0) {
          dinoY = 0;
          isJumping = false;
          dinoVY = 0;
        }
        dino.style.bottom = (groundY + dinoY) + 'px';
      }
      updateDinoAnim();
      updateCacti();
      if (checkCollision()) {
        endGame();
        return;
      }
      updateScore();
      gameLoopId = requestAnimationFrame(gameLoop);
    }

    function startGame() {
      dinoY = 0;
      dinoVY = 0;
      isJumping = false;
      isCrouching = false;
      cactusSpeed = 7;
      cactusInterval = 1200;
      score = 0;
      running = true;
      dinoFrame = 0;
      dinoAnimTimer = 0;
      dino.src = dinoIdleImg;
      dino.style.height = '47px';
      dino.style.width = '44px';
      dino.style.bottom = '0px';
      scoreElem.textContent = '0';
      gameOverElem.style.display = 'none';
      // Remove old cacti
      for (let cactus of cacti) cactus.remove();
      cacti = [];
      // Start cactus spawner
      cactusSpawner();
      // Start game loop
      gameLoop();
    }

    function endGame() {
      running = false;
      isCrouching = false; // Instantly uncrouch on game over
      dino.style.height = '47px';
      dino.style.width = '44px';
      dino.style.bottom = '0px';
      dino.src = dinoGameOverImg;
      gameOverElem.style.display = 'block';
      cancelAnimationFrame(gameLoopId);
      if (cactusSpawnerTimeout) clearTimeout(cactusSpawnerTimeout);
    }

    function restartGame() {
      showIdle();
      setTimeout(() => {
        startGame();
      }, 200);
    }

    function cactusSpawner() {
      if (!running) return;
      spawnCactus();
      // Always wait at least 1 second (1000ms) before next group
      let interval = Math.max(1000, cactusInterval - score * 2);
      cactusSpawnerTimeout = setTimeout(cactusSpawner, interval);
    }

    // Initial setup
    window.onload = () => {
      groundY = 0;
      showIdle();
    };
  </script>
</body>
</html>